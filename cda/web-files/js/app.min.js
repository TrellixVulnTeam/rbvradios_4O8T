"use strict";var app=angular.module("appSite",["ngRoute","Controller","Services","Directives","Filter","ngSanitize","angular-loading-bar","ngAnimate","ngFileUpload","ui.tinymce","ngCookies","duScroll"]);app.config(["$routeProvider","cfpLoadingBarProvider",function(e,t){tinyMCE.baseURL="/web-files/tinymce",t.includeSpinner=!1,e.when("/timeline",{templateUrl:"partials/timeline/index.html"}).when("/perfis",{templateUrl:"partials/perfil/perfis.html"}).when("/perfil/:perfilname",{templateUrl:"partials/perfil/index.html"}).when("/usuarios",{templateUrl:"partials/usuarios/index.html"}).when("/usuarios/adicionar",{templateUrl:"partials/usuarios/adicionar.html"}).when("/usuarios/editar/:id",{templateUrl:"partials/usuarios/editar.html"}).when("/auditoria",{templateUrl:"partials/auditoria/index.html"}).when("/minhaspostagens",{templateUrl:"partials/postagem/index.html"}).when("/postagem/adicionar",{templateUrl:"partials/postagem/adicionar.html"}).when("/postagem/editar/:id",{templateUrl:"partials/postagem/editar.html"}).otherwise({redirectTo:"/timeline"})}]);var ctrl=angular.module("Controller",["Services"]);ctrl.controller("PrincipalCtrl",["Usuarios","Auditoria","$http",function(e,t){var n=this;n.controle={},n.dadosLogado={},e.infologado().then(function(r){1==r.data[0].nivel?(n.controle.tipo="adm",n.controle.username=r.data[0].username,n.controle.nome=r.data[0].nome):2==r.data[0].nivel?(n.controle.tipo="usuario",n.controle.username=r.data[0].username,n.controle.nome=r.data[0].nome):n.controle.tipo="usuario",n.dadosLogado.nomecompleto=r.data[0].nome,n.dadosLogado.foto=r.data[0].foto,t.setUsuario(n.controle.nome),e.setUsulogado(r.data[0].token_id)},function(){alert(" Ops! Ocorreu um Erro! "),n.controle="usuario"})}]),ctrl.controller("AuditoriaCtrl",["Auditoria",function(e){var t=this;e.get().then(function(e){t.usuLista=e.data},function(){})}]),ctrl.controller("UsuariosCtrl",["Usuarios","$document","Upload","$filter",function(e,t,n,r){function i(){t.scrollTop(0,500)}function o(t){t.username=t.email,t.perfilname=r("lowerCaseNoSpace")(t.nome),e.insere(t).then(function(){a.usuarios="",i(),a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})}var a=this;e.get().then(function(e){a.usuLista=e.data}),a.deletar=function(t){e.deletar(t).then(function(){a.usuLista.splice(a.usuLista.indexOf(t),1),a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})},a.salvar=function(e){i(),n.upload({method:"POST",url:"service/usuarios/uploadfoto",fields:{},file:e.foto}).progress(function(e){a.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.foto=t,o(e),a.progress=0}).error(function(){})}}]),ctrl.controller("UsuariosEditCtrl",["$routeParams","Usuarios","$document","Upload",function(e,t,n,r){function i(){n.scrollTop(0,500)}function o(e){t.update(e).then(function(e){a.usuEdit=e.data,a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})}var a=this;t.getEdit(e.id).then(function(e){a.usuEdit=e.data[0]}),a.deletarFt=function(e,n){"foto"==e&&t.deleteFoto(n).then(function(){a.usuEdit.foto="",a.fotoDel=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})},a.alterar=function(e){i(),a.fotoDel?r.upload({method:"POST",url:"service/usuarios/uploadfoto",fields:{},file:e.foto}).progress(function(e){a.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.foto=t,o(e),a.progress=0,a.fotoDel=!1}).error(function(){}):o(e)}}]),ctrl.controller("PostagemCtrl",["Postagem","Usuarios",function(e,t){var n=this;e.getSpec(t.getUsulogado()).then(function(e){n.postLista=e.data}),n.deletar=function(t){window.confirm("Realmente deseja excluir?")&&e.deletar(t).then(function(){n.postLista.splice(n.postLista.indexOf(t),1),n.msgSuccess=!0,n.msgError=!1},function(){n.msgError=!0,n.msgSuccess=!1})}}]),ctrl.controller("PostagemAddCtrl",["Postagem","Usuarios","$document","Upload",function(e,t,n,r){function i(){n.scrollTop(0,500)}function o(n){n.token_dono=t.getUsulogado(),e.insere(n).then(function(){a.postagem="",i(),a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})}var a=this;a.salvar=function(e){i(),r.upload({method:"POST",url:"service/postagem/uploadaudio",fields:{},file:e.audio}).progress(function(e){a.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.audio=t,o(e),a.progress=0}).error(function(){})}}]),ctrl.controller("PostagemEditCtrl",["$routeParams","Postagem","Usuarios","$document","Upload",function(e,t,n,r,i){function o(e){t.update(e).then(function(t){s.postEdit=t.data,s.postEdit.audio=e.audio,s.msgSuccess=!0,s.msgError=!1},function(){s.msgError=!0,s.msgSuccess=!1})}function a(){r.scrollTop(0,500)}var s=this;t.getEdit(e.id).then(function(e){s.postEdit=e.data[0],null==s.postEdit.audio&&(s.audioDel=!0)}),s.deletarAudio=function(e,n){"audio"==e&&t.deleteAudio(n).then(function(){s.postEdit.audio="",s.audioDel=!0,s.msgError=!1},function(){s.msgError=!0,s.msgSuccess=!1})},s.alterar=function(e){a(),s.audioDel?i.upload({method:"POST",url:"service/postagem/uploadaudio",fields:{},file:e.audio}).progress(function(e){s.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.audio=t,e.audioModified=!0,o(e),s.progress=0,s.audioDel=!1}).error(function(){}):o(e)}}]),ctrl.controller("TimelineCtrl",["Timeline","Usuarios",function(e,t){function n(t){e.getSpec(t).then(function(e){r.timeLista=e.data})}var r=this;t.infologado().then(function(e){n(e.data[0].token_id)},function(){alert(" Ops! Ocorreu um Erro! ")})}]),ctrl.controller("TodoPerfisCtrl",["Usuarios",function(e){var t=this;e.getNotSpec(e.getUsulogado()).then(function(e){t.usuLista=e.data},function(){alert(" Ops! Ocorreu um Erro! ")})}]),ctrl.controller("PerfilCtrl",["$routeParams","Usuarios","Timeline",function(e,t,n){function r(e){n.getPerfil(e).then(function(e){i.timeLista=e.data})}var i=this;t.getSpec(e.perfilname).then(function(e){i.perfLista=e.data,r(e.data[0].token_id)},function(){alert(" Ops! Ocorreu um Erro! ")})}]);var dir=angular.module("Directives",["Controller","Services"]);dir.directive("fordata",[function(){return{restrict:"EA",replace:!0,link:function(e,t,n){var r=n.data,i=r.split("-");e.setData=i[2]+"/"+i[1]+"/"+i[0]}}}]),dir.directive("menu",[function(){return{restrict:"E",scope:{permissoes:"="},templateUrl:"directives/menu.html"}}]),dir.directive("loadingPage",["$http",function(){return{restrict:"A",scope:"true",link:function(e,t){e.$on("$routeChangeStart",function(){t.removeClass("loading-hide")}),e.$on("$routeChangeSuccess",function(){t.addClass("loading-hide")})}}}]);var fil=angular.module("Filter",[]);fil.filter("filBoolean",[function(){return function(e){return e?"Sim":"Não"}}]),fil.filter("toTrusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),fil.filter("lowerCaseNoSpace",[function(){return function(e){if(void 0!=e){for(var t=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],n=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],r=0;t.length>r;r++)e=e.replace(t[r],n[r]);return e=e.replace(/\s/g,""),e.toLowerCase()}}}]),angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["uiTinymceConfig",function(e){e=e||{};var t=0;return{priority:10,require:"ngModel",link:function(n,r,i,o){function a(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var n=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,r=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return e.replace(r,"").replace(n,function(e,n){return t.indexOf("<"+n.toLowerCase()+">")>-1?e:""})}var s,u,l,c=function(){o.$setViewValue(r.val()),n.$root.$$phase||n.$apply()};if(i.id||i.$set("id","uiTinymce"+t++),s=i.uiTinymce?n.$eval(i.uiTinymce):{},s.setup){var d=s.setup;delete s.setup}u={setup:function(e){e.on("init",function(){o.$render(),o.$setPristine()}),e.on("ExecCommand",function(){e.save(),c()}),e.on("KeyUp",function(){e.save(),c()}),e.on("SetContent",function(t){t.initial||o.$viewValue===t.content||(e.save(),c())}),e.on("blur",function(){r.blur()}),e.on("ObjectResized",function(){e.save(),c()}),d&&d(e)},mode:"exact",menubar:!1,statusbar:!1,plugins:"advlist autolink link image lists charmap print preview jbimages paste code youtube",toolbar:"bold | italic | removeformat | link | code ",forced_root_block:"p",paste_preprocess:function(e,t){t.content=a(t.content,"")},paste_postprocess:function(){},elements:i.id},angular.extend(u,e,s),setTimeout(function(){tinymce.init(u)}),o.$render=function(){l||(l=tinymce.get(i.id)),l&&l.setContent(o.$viewValue||"")},n.$on("$destroy",function(){l||(l=tinymce.get(i.id)),l&&(l.remove(),l=null)})}}}]);var service=angular.module("Services",[]);service.factory("Usuarios",["$http","$cookies","Auditoria",function(e,t,n){return{get:function(){return e.get("service/usuarios").success(function(){}).error(function(){})},getEdit:function(t){return e.get("service/usuarios/getedit/"+t).success(function(e){n.insere("Entrou para Editar a Usuário: "+e[0].nome)}).error(function(){})},getSpec:function(t){return e.get("service/usuarios/getspec/"+t).success(function(){}).error(function(){})},getNotSpec:function(t){return e.get("service/usuarios/getnotspec/"+t).success(function(){}).error(function(){})},insere:function(t){return e.post("service/usuarios/inserir",t).success(function(e){n.insere("Entrou para inserir um usuário: "+e.nome)}).error(function(){})},update:function(t){return e.post("service/usuarios/atualizar",t).success(function(e){n.insere("Entrou para atualizar um Usuário: "+e.nome)}).error(function(){})},deletar:function(t){return e.post("service/usuarios/delete",t).success(function(){n.insere("Entrou para deletar um Usuário: "+t.nome)}).error(function(){})},deleteFoto:function(t){return e.post("service/usuarios/deletefotousuario",t).success(function(){n.insere("Entrou para deletar uma Foto")}).error(function(){})},infologado:function(){return e.get("service/usuarios/infologado").success(function(){}).error(function(){})},setUsulogado:function(e){t.put("tokenDono",e)},getUsulogado:function(){return t.get("tokenDono")}}}]),service.factory("Postagem",["$http","Auditoria",function(e,t){return{get:function(){return e.get("service/postagem").success(function(){}).error(function(){})},getEdit:function(n){return e.get("service/postagem/getedit/"+n).success(function(e){t.insere("Entrou para editar uma postagem uma postagem: "+e[0].titulo)}).error(function(){})},getSpec:function(t){return e.get("service/postagem/getspec/"+t).success(function(){}).error(function(){})},insere:function(n){return e.post("service/postagem/inserir",n).success(function(e){t.insere("Inseriu uma postagem: "+e.titulo)}).error(function(){})},update:function(n){return e.post("service/postagem/atualizar",n).success(function(e){t.insere("Editou uma postagem: "+e.titulo)}).error(function(){})},deletar:function(n){return e.post("service/postagem/delete",n).success(function(){t.insere("Deletou uma postagem")}).error(function(){})},deleteAudio:function(n){return e.post("service/postagem/deleteaudio",n).success(function(){t.insere("Editou um audio")}).error(function(){})}}}]),service.factory("Timeline",["$http","Auditoria",function(e){return{get:function(){return e.get("service/timeline").success(function(){}).error(function(){})},getEdit:function(t){return e.get("service/timeline/getedit/"+t).success(function(){}).error(function(){})},getSpec:function(t){return e.get("service/timeline/getspec/"+t).success(function(){}).error(function(){})},getPerfil:function(t){return e.get("service/timeline/getperfil/"+t).success(function(){}).error(function(){})}}}]),service.factory("Auditoria",["$http",function(e){var t=null;return{get:function(){return e.get("service/auditoria").success(function(){}).error(function(){})},setUsuario:function(e){t=e},insere:function(n){if(!n.usuario){var r={};r.usuario=t,r.conteudo=n,n=r}return e.post("service/auditoria/inserir",n).success(function(){}).error(function(){})}}}]);