"use strict";var app=angular.module("appSite",["ngRoute","Controller","Services","Directives","Filter","ngSanitize","angular-loading-bar","ngAnimate","ngFileUpload","ngCookies","duScroll","ui.utils.masks"]);app.config(["$routeProvider","cfpLoadingBarProvider","$httpProvider",function(e,t,n){t.includeSpinner=!1,e.when("/usuarios",{templateUrl:"partials/usuarios/index.html"}).when("/usuarios/adicionar",{templateUrl:"partials/usuarios/adicionar.html"}).when("/usuarios/editar/:id",{templateUrl:"partials/usuarios/editar.html"}).when("/auditoria",{templateUrl:"partials/auditoria/index.html"}).when("/minhaspostagens",{templateUrl:"partials/postagem/index.html"}).when("/postagem/adicionar",{templateUrl:"partials/postagem/adicionar.html"}).when("/postagem/editar/:id",{templateUrl:"partials/postagem/editar.html"}).otherwise({redirectTo:"/minhaspostagens"}),n.interceptors.push("timestampInterceptor")}]);var ctrl=angular.module("Controller",["Services"]);ctrl.controller("PrincipalCtrl",["Usuarios","Auditoria",function(e,t){var n=this;n.controle={},n.dadosLogado={},e.infologado().then(function(r){switch(r.data[0].nivel){case 1:n.controle.tipo="adm",n.controle.username=r.data[0].username,n.controle.nome=r.data[0].nome;break;case 2:n.controle.tipo="usuario",n.controle.username=r.data[0].username,n.controle.nome=r.data[0].nome;break;default:n.controle.tipo="usuario"}n.dadosLogado.nomecompleto=r.data[0].nome,n.dadosLogado.foto=r.data[0].foto,t.setUsuario(n.controle.nome),e.setUsulogado(r.data[0].token_id)},function(){alert(" Ops! Ocorreu um Erro! "),n.controle="usuario"})}]),ctrl.controller("AuditoriaCtrl",["Auditoria",function(e){var t=this;e.get().then(function(e){t.usuLista=e.data},function(){})}]),ctrl.controller("UsuariosCtrl",["Usuarios","$document","Upload","$filter",function(e,t,n,r){function i(){t.scrollTop(0,500)}function o(t){t.username=t.email,t.perfilname=r("lowerCaseNoSpace")(t.nome),t.contas="{"+(""+a.selectedContas)+"}",e.insere(t).then(function(){a.usuarios="",i(),a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})}var a=this;a.selectedContas=[],e.get().then(function(e){a.usuLista=e.data}),a.deletar=function(t){e.deletar(t).then(function(){a.usuLista.splice(a.usuLista.indexOf(t),1),a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})},a.salvar=function(e){i(),n.upload({method:"POST",url:"service/usuarios/uploadfoto",fields:{},file:e.foto}).progress(function(e){a.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.foto=t,o(e),a.progress=0}).error(function(){})},a.toggleSelection=function(e){var t=a.selectedContas.indexOf(e);t>-1?a.selectedContas.splice(t,1):a.selectedContas.push(e)}}]),ctrl.controller("UsuariosEditCtrl",["$routeParams","Usuarios","$document","Upload",function(e,t,n,r){function i(){t.getEdit(e.id).then(function(e){u.usuEdit=e.data[0],u.tokens=a(e.data[0].contas).split(",")})}function o(e){e.username=e.email,e.contas="{"+(""+u.tokens)+"}",t.update(e).then(function(e){u.usuEdit=e.data,u.msgSuccess=!0,u.msgError=!1},function(){u.msgError=!0,u.msgSuccess=!1})}function a(e){return e.slice(1,-1)}function s(){n.scrollTop(0,500)}var u=this;u.tokens=[],t.get().then(function(e){u.usuarios=e.data,i()}),u.deletarFt=function(e,n){"foto"==e&&t.deleteFoto(n).then(function(){u.usuEdit.foto="",u.fotoDel=!0,u.msgError=!1},function(){u.msgError=!0,u.msgSuccess=!1})},u.alterar=function(e){s(),u.fotoDel?r.upload({method:"POST",url:"service/usuarios/uploadfoto",fields:{},file:e.foto}).progress(function(e){u.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.foto=t,o(e),u.progress=0,u.fotoDel=!1}).error(function(){}):o(e)},u.toggleSelection=function(e){var t=u.tokens.indexOf(e);t>-1?u.tokens.splice(t,1):u.tokens.push(e)}}]),ctrl.controller("PostagemCtrl",["Postagem","Usuarios",function(e,t){function n(t){e.getSpec(t).then(function(e){r.postLista=e.data})}var r=this;t.getForToken(t.getUsulogado()).then(function(e){var t=e.data[0].contas;n(t)}),r.deletar=function(t){window.confirm("Realmente deseja excluir?")&&e.deletar(t).then(function(){r.postLista.splice(r.postLista.indexOf(t),1),r.msgSuccess=!0,r.msgError=!1},function(){r.msgError=!0,r.msgSuccess=!1})}}]),ctrl.controller("PostagemAddCtrl",["Postagem","Usuarios","$document","Upload",function(e,t,n,r){function i(){n.scrollTop(0,500)}function o(t){e.insere(t).then(function(){a.postagem="",i(),a.msgSuccess=!0,a.msgError=!1},function(){a.msgError=!0,a.msgSuccess=!1})}var a=this;a.postagem={},t.getForToken(t.getUsulogado()).then(function(e){t.getSpec(e.data[0].contas).then(function(e){a.contas=e.data,a.postagem.token_dono=e.data[0].token_id})}),a.salvar=function(e){i(),r.upload({method:"POST",url:"service/postagem/uploadexp",fields:{valor:e.valor},file:e.arquivo}).progress(function(e){a.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.arquivo=t.oid,e.data=t.mes,o(e),a.progress=0}).error(function(){})}}]),ctrl.controller("PostagemEditCtrl",["$routeParams","Postagem","Usuarios","$document","Upload",function(e,t,n,r,i){function o(){t.getEdit(e.id).then(function(e){u.postEdit=e.data[0],0==u.postEdit.arquivo&&(u.arqDel=!0)})}function a(e){t.update(e).then(function(t){u.postEdit=t.data,u.postEdit.arquivo=e.arquivo,u.msgSuccess=!0,u.msgError=!1},function(){u.msgError=!0,u.msgSuccess=!1})}function s(){r.scrollTop(0,500)}var u=this;u.postagem={},n.getForToken(n.getUsulogado()).then(function(e){n.getSpec(e.data[0].contas).then(function(e){u.contas=e.data,o()})}),u.deletarArq=function(e,n){"arq"==e&&t.deleteArquivo(n).then(function(){u.postEdit.arquivo="",u.arqDel=!0,u.msgError=!1},function(){u.msgError=!0,u.msgSuccess=!1})},u.alterar=function(e){s(),u.arqDel?i.upload({method:"POST",url:"service/postagem/uploadexp",fields:{valor:e.valor},file:e.arquivo}).progress(function(e){u.progress=parseInt(100*e.loaded/e.total)}).success(function(t){e.arquivo=t.oid,e.data=t.mes,a(e),u.progress=0,u.arqDel=!1}).error(function(){}):a(e)}}]);var dir=angular.module("Directives",["Controller","Services"]);dir.directive("fordata",[function(){return{restrict:"EA",replace:!0,link:function(e,t,n){var r=n.data,i=r.split("-");e.setData=i[2]+"/"+i[1]+"/"+i[0]}}}]),dir.directive("menu",[function(){return{restrict:"E",scope:{permissoes:"="},templateUrl:"directives/menu.html"}}]),dir.directive("loadingPage",["$http",function(){return{restrict:"A",scope:"true",link:function(e,t){e.$on("$routeChangeStart",function(){t.removeClass("loading-hide")}),e.$on("$routeChangeSuccess",function(){t.addClass("loading-hide")})}}}]);var fil=angular.module("Filter",[]);fil.filter("filBoolean",[function(){return function(e){return e?"Sim":"Não"}}]),fil.filter("toTrusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),fil.filter("lowerCaseNoSpace",[function(){return function(e){if(void 0!=e){for(var t=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],n=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],r=0;t.length>r;r++)e=e.replace(t[r],n[r]);return e=e.replace(/\s/g,""),e.toLowerCase()}}}]);var service=angular.module("Services",[]);service.factory("Usuarios",["$http","$cookies","Auditoria",function(e,t,n){return{get:function(){return e.get("service/usuarios").success(function(){}).error(function(){})},getForToken:function(t){return e.get("service/usuarios/getfortoken/"+t).success(function(){}).error(function(){})},getEdit:function(t){return e.get("service/usuarios/getedit/"+t).success(function(e){n.insere("Entrou para Editar a Usuário: "+e[0].nome)}).error(function(){})},getSpec:function(t){return e.get("service/usuarios/getspec/"+t).success(function(){}).error(function(){})},getNotSpec:function(t){return e.get("service/usuarios/getnotspec/"+t).success(function(){}).error(function(){})},insere:function(t){return e.post("service/usuarios/inserir",t).success(function(e){n.insere("Entrou para inserir um usuário: "+e.nome)}).error(function(){})},update:function(t){return e.post("service/usuarios/atualizar",t).success(function(e){n.insere("Entrou para atualizar um Usuário: "+e.nome)}).error(function(){})},deletar:function(t){return e.post("service/usuarios/delete",t).success(function(){n.insere("Entrou para deletar um Usuário: "+t.nome)}).error(function(){})},deleteFoto:function(t){return e.post("service/usuarios/deletefotousuario",t).success(function(){n.insere("Entrou para deletar uma Foto")}).error(function(){})},infologado:function(){return e.get("service/usuarios/infologado").success(function(){}).error(function(){})},setUsulogado:function(e){t.put("tokenDono",e)},getUsulogado:function(){return t.get("tokenDono")}}}]),service.factory("Postagem",["$http","Auditoria",function(e,t){return{get:function(){return e.get("service/postagem").success(function(){}).error(function(){})},getEdit:function(n){return e.get("service/postagem/getedit/"+n).success(function(e){t.insere("Entrou para editar: "+e[0].data)}).error(function(){})},getSpec:function(t){return e.get("service/postagem/getspec/"+t).success(function(){}).error(function(){})},insere:function(n){return e.post("service/postagem/inserir",n).success(function(e){t.insere("Inseriu: "+e.data)}).error(function(){})},update:function(n){return e.post("service/postagem/atualizar",n).success(function(e){t.insere("Editou: "+e.data)}).error(function(){})},deletar:function(n){return e.post("service/postagem/delete",n).success(function(){t.insere("Deletou um relatorio")}).error(function(){})},deleteArquivo:function(n){return e.post("service/postagem/deletearquivo",n).success(function(){t.insere("Editou um Arquivo")}).error(function(){})}}}]),service.factory("Auditoria",["$http",function(e){var t=null;return{get:function(){return e.get("service/auditoria").success(function(){}).error(function(){})},setUsuario:function(e){t=e},insere:function(n){if(!n.usuario){var r={};r.usuario=t,r.conteudo=n,n=r}return e.post("service/auditoria/inserir",n).success(function(){}).error(function(){})}}}]),service.factory("timestampInterceptor",[function(){return{request:function(e){var t=e.url;return t.indexOf("view")>-1?e:(e.url=t+"?nocache="+(new Date).getTime(),e)}}}]);